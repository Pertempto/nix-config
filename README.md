# nix-config

This repository holds my NixOS + Home-Manager configuration using the flakes approach for both a USB-drive sandbox installation and a full laptop installation.

> [!WARNING]
> This README was generated by ChatGPT. I will refine it as I figure out what I'm doing. Currently, NixOS is all new to me.

---

## Table of Contents

- [Bootstrap / Initial Setup](#bootstrap-initial-setup)
- [Using the Flake](#using-the-flake)
- [Hosts & Hardware Profiles](#hosts-&-hardware-profiles)
- [Applications & Workflow](#applications-&-workflow)
- [USB Sandbox Strategy](#usb-sandbox-strategy)
- [Migration to Internal Install or Dual-Boot](#migration-to-internal-install-or-dual-boot)
- [Maintenance & Upgrades](#maintenance-&-upgrades)
- [Security & Secrets](#security-&-secrets)
- [Roadmap](#roadmap)
- [License](#license)

---

## Bootstrap / Initial Setup

1. On your USB-drive test installation of NixOS, enable flakes in `/etc/nixos/configuration.nix`:

   ```nix
   nix.settings.experimental-features = [ "nix-command" "flakes" ];
   ```

2. Clone this repository:

   ```bash
   git clone https://github.com/pertempto/nix-config.git ~/nix-config
   cd ~/nix-config
   ```

3. Apply your host configuration:

   ```bash
   sudo nixos-rebuild switch --flake .#usbSandbox
   ```

---

## Using the Flake

- Rebuild system configuration:

  ```bash
  sudo nixos-rebuild switch --flake .#<host-name>
  ```

- Rebuild or switch Home-Manager configuration:

  ```bash
  home-manager switch --flake .#<user>@<host-name>
  ```

- Update inputs and lock file:

  ```bash
  nix flake update
  git add flake.lock
  git commit -m "chore: update flake inputs"
  ```

---

## Hosts & Hardware Profiles

- **Dev Server** (`devServer`): For my homelab dev server. It runs in a ProxMox virtual machine.
- **USB Sandbox** (`usbSandbox`): For getting started without committing to a full installation to my hard drive.
- **Work Laptop** (`thinkpad`): For my ThinkPad T490 work laptop. I won't start this host until I'm comfortable in the USB sandbox.
- Additional host profiles may be added as needed.

---

## Applications & Workflow

- List all your current Pop!\_OS applications.
- In your `home/users/pertempto.nix` or modules, declare packages via `environment.systemPackages` (system) or `home.packages` (user).
- Mark each application as:
  - ✅ works out of the box (nixpkgs)
  - ⚠️ requires overlay or custom packaging
- Use overlays for custom or missing packages.
- Configure Wayland, preferred terminal (kitty/alacritty), keyboard-centred hotkeys via Home-Manager or system modules.

---

## USB Sandbox Strategy

- Use the external drive as a “safe sandbox” to:
  - Test hardware compatibility without modifying your main OS.
  - Build and refine your flake config until workflows and hardware are reliable.
  - Validate your dev environment (Node 20, editor, terminal, etc).

- Note: USB-drive performance may be slower (especially builds) — acceptable for sandbox use.

---

## Migration to Internal Install or Dual-Boot

- Backup all important data from your current OS.
- Decide strategy:
  - **Replace Pop!\_OS**: Install NixOS on internal drive with your tested flake.
  - **Dual-boot**: Install alongside Pop!\_OS and use it as fallback.
- On internal install: clone this repo, apply `thinkpad` host profile.
- Update bootloader/EFI settings if dual-booting.
- After stability, optionally retire Pop!\_OS or repurpose its space.

---

## Maintenance & Upgrades

- Periodically run `nix flake update` to refresh inputs; commit changes.
- Use Git branches when experimenting (e.g., switching compositors).
- Tag stable config releases if desired.
- Keep hardware-specific modules separated for reuse across hosts.

---

## Security & Secrets

- **Do not commit secrets** (API keys, private keys, credentials) to this repo.
- Use encrypted stores or separate private repo/branch for sensitive data.
- Reference secrets via mounts, environment variables or encrypted files, not in plain config files.

---

## Roadmap

- [x] Create `flake.nix` with proper inputs and outputs.
- [ ] Define `usbSandbox` profile
- [ ] Create Home-Manager config for user `addison`.
- [ ] List current applications from Pop!\_OS and check availability.
- [ ] Configure Wayland, terminal, keyboard-centric workflow.
- [ ] Install NixOS on USB drive (sandbox) and apply config.
- [ ] Test hardware (WiFi, GPU, battery, power) on sandbox.
- [ ] Iterate configuration until system and home workflows are stable.
- [ ] Backup Pop!\_OS and data.
- [ ] Define `thinkpad` profile
- [ ] Install NixOS on internal drive (or dual-boot) using this repo.
- [ ] Clone repo on internal install and apply `thinkpad` profile.
- [ ] Verify everything works; optionally retire Pop!\_OS.
- [ ] Set up periodic maintenance/upgrades (flake update, version control).

---

## License

This configuration is licensed under the [MIT License](LICENSE).
Feel free to fork and adapt, though your hardware and preferences may differ.
